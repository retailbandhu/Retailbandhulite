import{r as n,s as h,j as e,T as Y,S as G,I as b,B as P,X as T,t as c}from"./index-V23vquzg.js";import{A as X}from"./arrow-left-BzwCOdhx.js";import{P as q}from"./plus-W1R3slHK.js";import{C as J}from"./circle-alert-B6dtfcpg.js";import{D as Z}from"./download-CYNHsznw.js";import{M as D}from"./message-circle-Cp6kwdTm.js";import{I as ee}from"./indian-rupee-BFJlZLaT.js";import{H as M}from"./history-CO8mchEd.js";import{C as $}from"./circle-check-big-C5JSCYiK.js";function ce({onNavigate:B}){const[p,L]=n.useState(""),[i,f]=n.useState([]),[v,w]=n.useState([]),[s,g]=n.useState(null),[R,u]=n.useState(!1),[I,C]=n.useState(!1),[d,j]=n.useState(""),[k,S]=n.useState(""),[y,K]=n.useState("all"),[x,O]=n.useState("amount");n.useEffect(()=>{const t=h.getCustomers()||[],a=h.getKhataEntries()||[];f(t),w(a)},[]);const E=i.filter(t=>t.name.toLowerCase().includes(p.toLowerCase())||t.phone.includes(p)),H=i.reduce((t,a)=>t+a.totalCredit,0),U=i.filter(t=>t.totalCredit>0).length,W=t=>{const a=`Namaste ${t.name} ji,%0A%0AYeh aapka khata reminder hai.%0ABaki raashi: â‚¹${t.totalCredit}%0A%0AKripya jaldi payment karein.%0ADhanyavaad!%0A%0A- ${localStorage.getItem("storeName")||"Your Store"}`;window.open(`https://wa.me/${t.phone.replace(/\D/g,"")}?text=${a}`,"_blank")},A=t=>{g(t),j(t.totalCredit.toString()),u(!0)},_=()=>{if(!s||!d||parseFloat(d)<=0){c.error("Please enter valid payment amount");return}const t=parseFloat(d);if(t>s.totalCredit){c.error("Payment amount exceeds credit amount");return}const a={id:Date.now().toString(),customerId:s.id,customerName:s.name,phone:s.phone,amount:t,type:"payment",date:new Date().toISOString(),notes:k},l=[...v,a];w(l),h.setKhataEntries(l);const o=i.map(r=>r.id===s.id?{...r,totalCredit:r.totalCredit-t}:r);f(o),h.setCustomers(o),c.success(`â‚¹${t} payment received from ${s.name}!`),u(!1),j(""),S(""),g(null)},z=t=>{g(t),C(!0)},F=()=>{const t=[["Customer Name","Phone","Outstanding Amount","Last Transaction","Transaction Count"],...i.filter(r=>r.totalCredit>0).map(r=>[r.name,r.phone,r.totalCredit,r.lastTransaction,r.transactionCount])].map(r=>r.join(",")).join(`
`),a=new Blob([t],{type:"text/csv"}),l=URL.createObjectURL(a),o=document.createElement("a");o.href=l,o.download=`khata_book_${new Date().toISOString().split("T")[0]}.csv`,o.click(),c.success("Khata book exported!")},Q=()=>{const t=i.filter(a=>a.totalCredit>0);c.success(`Sending reminders to ${t.length} customers!`,{duration:3e3})},V=t=>{confirm(`Mark â‚¹${t.totalCredit} as paid for ${t.name}?`)&&A(t)};let m=[...E];if(y!=="all"){const a={"30days":30,"60days":60,"90days":90}[y];m=m.filter(l=>l.daysSinceLastTransaction&&l.daysSinceLastTransaction>=a)}m.sort((t,a)=>x==="amount"?a.totalCredit-t.totalCredit:x==="name"?t.name.localeCompare(a.name):x==="days"?(a.daysSinceLastTransaction||0)-(t.daysSinceLastTransaction||0):0);const N=s?v.filter(t=>t.customerId===s.id).reverse():[];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-[#1E88E5]/5 to-[#FF6F00]/5 pb-24",children:[e.jsxs("div",{className:"bg-gradient-to-r from-[#1E88E5] to-[#FF6F00] p-6 rounded-b-3xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>B("dashboard"),className:"text-white",children:e.jsx(X,{className:"w-6 h-6"})}),e.jsx("h1",{className:"text-white text-xl",children:"Khata Management"}),e.jsx("button",{className:"text-white",children:e.jsx(q,{className:"w-6 h-6"})})]}),e.jsx("p",{className:"text-white/90 text-center",children:"Customer credit aur udhaar track karein"})]}),e.jsxs("div",{className:"px-6 pt-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-red-500 to-red-600 rounded-2xl p-4 text-white shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Y,{className:"w-6 h-6"}),e.jsx("span",{className:"text-xs bg-white/20 px-2 py-1 rounded-full",children:"Total"})]}),e.jsxs("p",{className:"text-2xl mb-1",children:["â‚¹",H]}),e.jsx("p",{className:"text-white/80 text-sm",children:"Outstanding Amount"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-2xl p-4 text-white shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(J,{className:"w-6 h-6"}),e.jsx("span",{className:"text-xs bg-white/20 px-2 py-1 rounded-full",children:"Active"})]}),e.jsx("p",{className:"text-2xl mb-1",children:U}),e.jsx("p",{className:"text-white/80 text-sm",children:"Customers with Credit"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(b,{type:"text",placeholder:"Customer name ya phone search karein...",value:p,onChange:t=>L(t.target.value),className:"pl-12 h-12 bg-white border-gray-200 rounded-xl"})]}),e.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl p-4 border border-purple-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ’¡"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-gray-900 mb-1",children:"Bandhu ka Tip"}),e.jsx("p",{className:"text-gray-600 text-sm leading-relaxed",children:"WhatsApp reminder bhej kar apna outstanding amount jaldi recover karein!"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm p-3 space-y-3",children:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("select",{value:x,onChange:t=>O(t.target.value),className:"px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm",children:[e.jsx("option",{value:"amount",children:"Sort: Amount"}),e.jsx("option",{value:"name",children:"Sort: Name"}),e.jsx("option",{value:"days",children:"Sort: Days Overdue"})]}),e.jsxs("select",{value:y,onChange:t=>K(t.target.value),className:"px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm",children:[e.jsx("option",{value:"all",children:"All Customers"}),e.jsx("option",{value:"30days",children:"30+ Days"}),e.jsx("option",{value:"60days",children:"60+ Days"}),e.jsx("option",{value:"90days",children:"90+ Days"})]}),e.jsxs("button",{onClick:F,className:"ml-auto flex items-center gap-2 px-3 py-2 bg-green-50 text-green-600 rounded-lg text-sm hover:bg-green-100 transition-colors",children:[e.jsx(Z,{className:"w-4 h-4"}),"Export CSV"]}),e.jsxs("button",{onClick:Q,className:"flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg text-sm hover:shadow-md transition-all",children:[e.jsx(D,{className:"w-4 h-4"}),"Bulk Reminders"]})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-gray-900",children:["All Customers (",E.length,")"]}),e.jsx("button",{className:"text-[#1E88E5] text-sm",children:"Sort by Amount"})]}),e.jsx("div",{className:"space-y-3",children:m.map(t=>e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-[#1E88E5] to-[#FF6F00] rounded-full flex items-center justify-center text-white",children:t.name.charAt(0)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-gray-900 mb-1",children:t.name}),e.jsx("p",{className:"text-gray-500 text-sm mb-1",children:t.phone}),e.jsxs("p",{className:"text-gray-400 text-xs",children:[t.transactionCount," transactions â€¢ ",t.lastTransaction]})]})]}),e.jsx("div",{className:"text-right",children:t.totalCredit>0?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-red-600 mb-1",children:["â‚¹",t.totalCredit]}),e.jsx("span",{className:"text-xs bg-red-50 text-red-600 px-2 py-1 rounded-full",children:"Pending"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-green-600 mb-1",children:"â‚¹0"}),e.jsx("span",{className:"text-xs bg-green-50 text-green-600 px-2 py-1 rounded-full",children:"Clear"})]})})]}),t.totalCredit>0&&e.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-3 border-t border-gray-100",children:[e.jsxs("button",{onClick:()=>A(t),className:"bg-gradient-to-r from-[#1E88E5] to-blue-600 text-white rounded-lg py-2 flex items-center justify-center gap-2 hover:shadow-md transition-all text-sm",children:[e.jsx(ee,{className:"w-4 h-4"}),"Collect Payment"]}),e.jsxs("button",{onClick:()=>z(t),className:"bg-gray-50 text-gray-700 rounded-lg py-2 flex items-center justify-center gap-2 hover:bg-gray-100 transition-colors text-sm",children:[e.jsx(M,{className:"w-4 h-4"}),"History"]}),e.jsxs("button",{onClick:()=>W(t),className:"bg-green-50 text-green-700 rounded-lg py-2 flex items-center justify-center gap-2 hover:bg-green-100 transition-colors text-sm",children:[e.jsx(D,{className:"w-4 h-4"}),"Reminder"]}),e.jsxs("button",{onClick:()=>V(t),className:"bg-purple-50 text-purple-700 rounded-lg py-2 flex items-center justify-center gap-2 hover:bg-purple-100 transition-colors text-sm",children:[e.jsx($,{className:"w-4 h-4"}),"Mark Paid"]})]})]},t.id))})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-md p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-gray-900 mb-1",children:"Export Khata Report"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Download complete credit report"})]}),e.jsx(P,{onClick:F,className:"bg-gradient-to-r from-[#1E88E5] to-[#FF6F00]",children:"Export"})]})})]}),R&&s&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-t-3xl w-full max-w-md p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl text-gray-900",children:"Collect Payment"}),e.jsx("button",{onClick:()=>u(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(T,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Customer"}),e.jsx("p",{className:"text-lg text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.phone}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total Outstanding"}),e.jsxs("p",{className:"text-2xl text-red-600",children:["â‚¹",s.totalCredit]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Payment Amount (â‚¹) *"}),e.jsx(b,{type:"number",placeholder:"Enter amount",value:d,onChange:t=>j(t.target.value),className:"h-12"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"Notes (Optional)"}),e.jsx(b,{type:"text",placeholder:"Payment method, reference number, etc.",value:k,onChange:t=>S(t.target.value),className:"h-10"})]}),e.jsxs(P,{onClick:_,disabled:!d||parseFloat(d)<=0,className:"w-full bg-gradient-to-r from-[#1E88E5] to-[#FF6F00] text-white h-12 flex items-center justify-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),"Receive Payment"]})]})}),I&&s&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-t-3xl w-full max-w-md p-6 space-y-4 max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl text-gray-900",children:"Payment History"}),e.jsx("button",{onClick:()=>C(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(T,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-gray-900 text-lg mb-1",children:s.name}),e.jsx("p",{className:"text-gray-500 text-sm mb-3",children:s.phone}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Current Outstanding"}),e.jsxs("p",{className:"text-xl text-red-600",children:["â‚¹",s.totalCredit]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Total Transactions"}),e.jsx("p",{className:"text-xl text-gray-900",children:N.length})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-gray-900",children:"Transaction History"}),N.length>0?N.map(t=>e.jsx("div",{className:"bg-gray-50 rounded-xl p-3",children:e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${t.type==="credit"?"bg-red-100 text-red-700":"bg-green-100 text-green-700"}`,children:t.type==="credit"?"Credit Given":"Payment Received"})}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(t.date).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})}),t.notes&&e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:t.notes})]}),e.jsxs("p",{className:`text-lg ${t.type==="credit"?"text-red-600":"text-green-600"}`,children:[t.type==="credit"?"+":"-","â‚¹",t.amount]})]})},t.id)):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(M,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No transaction history"})]})]})]})})]})}export{ce as KhataManagement};
